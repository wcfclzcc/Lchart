<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>设备详情</title>
   <script src="/static/mqtt.js" type="text/javascript"> </script>
   <!--   <script src="mqtt.js" type="text/javascript"></script>-->
    <script src="/static/jquery.js"></script>
    <link rel="stylesheet" type="text/css" href="/static/iview/dist/styles/iview.css">
    <script type="text/javascript" src="/static/vue.js"></script>
    <script type="text/javascript" src="/static/iview/dist/iview.min.js"></script>

    <script type="text/javascript" src="/static/FileSaver.js"></script>
    <script type="text/javascript" src="/static/xlsx.mini.js"></script>
    <script type="text/javascript" src="/static/canvas-toBlob.js"></script>


</head>
<body style="background-color:#f8f8f9">

<div id="navigater">
        <template>
            <i-menu mode="horizontal" :theme="theme1" active-name="1" @on-select="select">
                <menu-item name="1">
                    <Icon type="ios-stats" ></Icon>
                    设备列表
                </menu-item>
                <menu-item name="2">
                    <Icon type="ios-construct"  ></Icon>
                    工具
                </menu-item>
                <menu-item name="3">
                    <Icon type="ios-people"  ></Icon>
                    用户管理
                </menu-item>
                <menu-item name="4">
                    <Icon type="ios-paper"  ></Icon>
                    说明
                </menu-item>
            </i-menu>

        </template>
            <h1 id="user" style="">用户：</h1>
    <i-button type="primary" @click="cancel">注销</i-button>

</div>


<br><br>
 <h3 style="margin-left:16px">当前设备名称：{{ device_name }}</h3>
<br>
<h3 id="status" style="margin-left:16px">当前状态：</h3>
<br>
<h3 id="now" style="margin-left:16px">当前温度：&#160;&#160;&#160;当前湿度：</h3>

<br>



<div id="switch_time_mode" >
        <Row type="flex" class="code-row-bg">
        <i-col span="21" >
               <div id ="show1" style="margin-left:16px" @mousedown="click_down" @mouseup="click_up">
             <canvas  id="myCanvas" width="1200" height="500" style="border:1px solid #d3d3d3; background-color: rgba(230, 230, 230,0.1);">
        您的浏览器不支持 HTML5 canvas 标签。</canvas>
            </div>
        </i-col>
        <i-col span="3" >
               <div >
                   <br><br><br>
                    <Row type="flex" justify="center" align="middle" class="code-row-bg">
                    <i-col span="12"  >
                        <i-switch size="large" true-color="#13ce66" false-color="#5cadff"  @on-change="change_time_mode">
                            <span slot="open">相对</span>
                            <span slot="close">绝对</span>

                        </i-switch>
                    </i-col>
                        <i-col span="8"  >
                        <i-switch size="large" true-color="#000" false-color="#000"  @on-change="change_mode" :disabled="disabled">
                            <span slot="open">历史</span>
                            <span slot="close">实时</span>

                        </i-switch>

                    </i-col>
                    </Row>
                   <br><br><br><br><br>


                    <Row type="flex" justify="center" align="middle" class="code-row-bg">
                    <i-col span="8">
                        <color-picker v-model="color_hpv" />
                    </i-col>
                        <i-col span="12">

                        湿度开关<i-switch  :value="true" v-model="switch1" @on-change="hpv_switch" />
                    </i-col>
                    </Row>
                   <br><br>
                        <Row type="flex" justify="center" align="middle" class="code-row-bg">

                    <i-col span="8" >
                        <color-picker v-model="color_tpv" />
                    </i-col>
                        <i-col span="12"  >
                        温度开关<i-switch  :value="true" v-model="switch2" @on-change="tpv_switch" />
                    </i-col>

                </Row>
                   <br><br><br><br><br>


                    <Row type="flex" justify="center" align="middle" class="code-row-bg">
                        <i-col span="14" >
                        区域选择开关
                        </i-switch>
                    </i-col>
                    <i-col span="6" >
                        <i-switch @on-change="allow_select" >
                                <span slot="open">开</span>
                                <span slot="close">关</span>
                        </i-switch>
                    </i-col>
                    </Row>
                   <br><br><br>
                        <Row type="flex" justify="center" align="middle" class="code-row-bg">
                            <i-col span="14"  >
                        放大y轴开关
                        </i-switch>
                    </i-col>
                    <i-col span="6"  >
                        <i-switch @on-change="x_zoom" >
                                <span slot="open">开</span>
                                <span slot="close">关</span>
                        </i-switch>
                    </i-col>
                </Row>


                </div>
            </i-col>

        </Row>
            <Row type="flex" class="code-row-bg" justify="center">
                            <i-col span="6" >
                                <div id="date_picker" style="display:none">
                                    <date-picker
                                        type="datetimerange"
                                        :options="time_limit"
                                        @on-change="data_select"
                                         @on-open-change="close_open"
                                        placeholder="选择需要查看的时间段" style="width: 300px"></date-picker>
                                </div>
                            </i-col>
                        </Row>




</div>
<br>
<div id="other_function" >
        <Row type="flex" class="code-row-bg">
            <i-col span="2" >
                <i-button type="primary" @click="get_word">生成word</i-button>
            </i-col>
            <i-col span="3" >
                <i-button type="primary" @click="get_excel">生成Excel</i-button>
            </i-col>

            <i-col span="2" >
                设置温度
                <i-input v-model="set_tpv" icon="ios-clock-outline" placeholder="Enter something..." style="width: 100px" />
            </i-col>

            <i-col span="2" >
                设置湿度
                <i-input v-model="set_hpv" icon="ios-clock-outline" placeholder="Enter something..." style="width: 100px" />
            </i-col>
            <i-col span="2" >
                <i-button type="primary" @click="set_submit">提交</i-button>
            </i-col>

            <i-col span="2" >
                设置时间
                <input-number :max="10" :min="1" v-model="set_time"></input-number>
            </i-col>
            <i-col span="2" >
                <i-button type="primary" @click="settime_submit">提交</i-button>
            </i-col>


            <i-col span="2" >
                 <i-button @click="set_run" icon="ios-power" type="info">运行</i-button>
            </i-col>

            <i-col span="2" >
                 <i-button @click="set_stop" icon="ios-power" type="error">停止</i-button>
            </i-col>

            <i-col span="1" >
                <i-button @click="set_reset" type="warning">复位</i-button>
            </i-col>
            <i-col span="1" >
                <i-button type="primary" @click="set_jump">跳段</i-button>
            </i-col>

        </Row>


</div>





<div class="box" id="box"style="position: absolute;left: 0px;top: 0px;display: none;" >
     <canvas id="myCanvas1" width="150" height="100" style="background-color: rgba(47, 183, 245, 0.2);"></canvas>
</div>

<div id="accept"></div>
<p id="accept1"></p>

{#    <div>#}
{#        <form action="/upload" method="post" enctype="multipart/form-data">#}
{#            {% csrf_token %}#}
{#            <input type="file" name="myfile" style="color: brown">#}
{#            <input type="submit" value="开始上传">#}
{#        </form>#}
{#    </div>#}
</body>
<script>



var url = window.location.pathname; /* 获取文件路径（文件地址） */

//建立mqtt连接

		var hostname = '43.226.146.218', //'192.168.1.2',mqtt接口地址
            port = 8083,
            clientId = 'clit-'+Math.floor(Math.random()*10),//客户端id
            timeout = 5,//重连时间
            keepAlive = 100,//每一百秒连接一次
            cleanSession = false,
            ssl = false,
            topic = '/test';//主题
        client = new Paho.MQTT.Client(hostname,port, clientId);//建立客户端实例

        var options = {//准备传入connect的参数
            invocationContext: {
                host: hostname,//接口地址
                port: port,//端口
                path: client.path,
                clientId: clientId//客户端名称
            },
            timeout: timeout,
            keepAliveInterval: keepAlive,
            cleanSession: cleanSession,
            useSSL: ssl,
            // userName: userName,
            // password: password,
            onSuccess: onConnect,//连接成功函数
            onFailure: function (e) {//连接失败函数
                console.log("connect failure");
            }
        };
        client.connect(options);
        //连接服务器并注册连接成功处理事件
        function onConnect() {
            console.log("onConnected");//控制台输出
            alert(topic)
            client.subscribe('/test');//订阅主题

        }

        client.onConnectionLost = onConnectionLost;

        //注册连接断开处理事件
        client.onMessageArrived = onMessageArrived;

        //注册消息接收处理事件
        function onConnectionLost(responseObject) {
            console.log(responseObject);
            if (responseObject.errorCode !== 0) {
                console.log("onConnectionLost:" + responseObject.errorMessage);
                console.log("连接已断开");
            }
        }

        function onMessageArrived(message) {
            console.log(message.destinationName);

                if (date_time_mode.acctime_mode == 0)//当前模式为实时接收
                {
                    var obj = JSON.parse(message.payloadString);
                    //console.log(obj);

                    display_data.data1.push(obj.data1);
                    display_data.data2.push(obj.data2);
                    display_data.data3.push(obj.data3);
                    display_data.data4.push(obj.data4);
                    //display_data.time.push(new Date().Format("yyyy-MM-dd hh:mm:ss"));

                    //console.log(display_data);

                        data_time.push(new Date().Format("yyyy-MM-dd hh:mm:ss"));
                        data_time_absolute = data_time_absolute.concat(new Date().Format("yyyy-MM-dd hh:mm:ss"));

                        //console.log(display_data_change);

                }

            //console.log("消息受到");
            //console.log(tpv);
        }


        function send() {//发送信息
            var s = document.getElementById("msg").value;//获得输入框内容
            if (s) {
                message = new Paho.MQTT.Message(s);//新建message对象
                message.destinationName = topic;//设置主题
                client.send(message);//发送
                document.getElementById("msg").value = "";//清空输入框
            }
        }


        function send_new_program(data) {//发送信息

            data.data_type =1;
            data.pgm_type =2;
            var data_str=JSON.stringify(data);
            message = new Paho.MQTT.Message(data_str);//新建message对象
            message.destinationName = "/to_device";//设置主题
            client.send(message);//发送


        }

        function send_read_program(data) {//发送信息

            data.data_type =1;
            data.pgm_type =0;
            var data_str=JSON.stringify(data);
            message = new Paho.MQTT.Message(data_str);//新建message对象
            message.destinationName = "/to_device";//设置主题
            client.send(message);//发送


        }

        function send_delete_program(data) {//发送信息

            data.data_type =1;
            data.pgm_type =4;
            var data_str=JSON.stringify(data);
            message = new Paho.MQTT.Message(data_str);//新建message对象
            message.destinationName = "/to_device";//设置主题
            client.send(message);//发送


        }

        function send_edit_program(data) {//发送信息

            data.data_type =1;
            data.pgm_type =1;
            var data_str=JSON.stringify(data);
            message = new Paho.MQTT.Message(data_str);//新建message对象
            message.destinationName = "/to_device";//设置主题
            client.send(message);//发送


        }

        function send_set(data) {
            data.data_type =0;
            data.pgm_type =1;
            var data_str=JSON.stringify(data);
            message = new Paho.MQTT.Message(data_str);//新建message对象
            message.destinationName = "/to_device";//设置主题
            client.send(message);//发送
        }

        function send_start_stop(data) {
            data.data_type =0;
            data.pgm_type =2;
            var data_str=JSON.stringify(data);
            message = new Paho.MQTT.Message(data_str);//新建message对象
            message.destinationName = "/to_device";//设置主题
            client.send(message);//发送

        }

        function send_mode_choose(data) {
            data.data_type =0;
            data.pgm_type =3;
            var data_str=JSON.stringify(data);
            message = new Paho.MQTT.Message(data_str);//新建message对象
            message.destinationName = "/to_device";//设置主题
            client.send(message);//发送

        }


        function delete_file(url) {//60s后删除之前生成的word
            $.ajax(
            {
                url: "/delete_file/",
                type: "GET",
                data: {url:url},
                success: function (data) {//获取数据成功
                    console.log("文件删除"+data);

               },

                error: function (data) {
                    alert("获取失败")
                }

            })

        }






        function get_status() {//获取状态
            console.log("准备获取数据");
             //document.getElementById("acc").innerHTML ="当前设备："+ document.getElementById("num").value,
             $.ajax(
            {
                url: "/getstatus_temporary/",
                type: "GET",
                data: {device_id:device_id},
                success: function (data) {//获取数据成功
                    console.log("successs");
                    //console.log(data);
                    var da=JSON.parse(data);
                    console.log(da);
                    tpv.length = 0;
                    hpv.length = 0;
                    data_time.length=0;
                    data_time_absolute.length=0;
                    var i=0;
                    for(i=0;i<da.length;i++)
                    {
                        data_time=data_time.concat(da[i][7]);
                        data_time_absolute=data_time_absolute.concat(da[i][7]);
                        tpv=tpv.concat(da[i][2]);//把当前数据拼接到数组里去
                        hpv=hpv.concat(da[i][3]);//把当前数据拼接到数组里去

                    }

               },

                error: function (data) {
                    alert("获取失败")
                }

            });
        }


        function get_history()
        {
            $.ajax(
            {
                url: "/get_history/",
                type: "GET",
                data: {device_id:device_id},
                cache: true,
                async: true,
                success: function (data) {//获取数据成功
                    console.log("successs");

                    var da=JSON.parse(data);


                    tpv.length = 0;
                    hpv.length = 0;
                    data_time.length=0;
                    data_time_absolute.length=0;
                    var i=0;
                    for(i=0;i<da.length;i++)
                    {

                        data_time.push(da[i][0]);
                        data_time_absolute.push(da[i][0]);
                        tpv.push(da[i][2]);
                        hpv.push(da[i][1]);
                        //data_time=data_time.concat(da[i][0]);
                        //data_time_absolute=data_time_absolute.concat(da[i][0]);
                        //tpv=tpv.concat(da[i][2]);//把当前数据拼接到数组里去
                        //hpv=hpv.concat(da[i][1]);//把当前数据拼接到数组里去

                    }
                    alert(da.length);
                    //tpv=data_off(tpv);
                    //hpv=data_off(hpv);
                    //data_time_absolute=data_off(data_time_absolute);
                    //data_time=data_off(data_time);

               },

                error: function (data) {
                    alert("获取失败")
                }

            })
        }
</script>


<script>




        function detail_text(index)
        {
             var box = document.getElementById('box');
             box.style.display = "block";
            var c=document.getElementById("myCanvas1");//获得canvas
            var ctx1=c.getContext("2d");
             var wid=c.getAttribute("width");
             var hei=c.getAttribute("height");
             c.setAttribute("height","150");
             ctx1.clearRect(0, 0, wid, hei); //清空所有的内容


            ctx1.fillStyle="#555";

             ctx1.font = "bold 15px Arial";
             var he=15;
             for(let key in display_data_change)
             {
                 ctx1.fillText(key+"："+display_data_change[key][index].toFixed(2),5,he);
                 he+=30;
             }


            //ctx1.fillText(data_time_change[index],5,he);//画出时间信息

             box.style.left = parseInt(mouse_x)+50 + "px";
             box.style.top =parseInt(mouse_y)+290 + "px";


        }




        function data_off(data)//数据舍去
        {
                if(data.length>width)
                {
                    var da = new Array();
                    for(var i=0;i<width;i++)
                    {
                        da[i]=data[parseInt(i*(data.length-1)/width-1)];
                    }
                    return da;
                }
                else{
                    return data;
                }

        }






        function x_transform(len,pos) {//index转换为pos

            return Math.round(pos*width/(len-1));
        }
        function x_transform_back(len,pos) {//pos转换为index

            return Math.round(pos*(len-1)/width);
        }

        function draw_data_all(ctx,data,c1,t1) {


            for(var i=1;i<data.length;i++)
            {
                drawLine(ctx,x_transform(data.length,i-1),data_handel(data[i-1]),x_transform(data.length,i),data_handel(data[i]),c1,t1);
            }
            //document.getElementById("accept1").innerHTML="";


                if(data.length<width/15)//绘画点
                {
                    for(var i=0;i<data.length;i++)
                    {
                        drawc(ctx,x_transform(data.length,i),data_handel(data[i]),"#fff",4);
                        drawc(ctx,x_transform(data.length,i),data_handel(data[i]),"#2db7f5",3);
                    }

                }

        }






   function drawreact(ctx,x1,y1,x2,y2,color,thick)//画矩形
        {
            drawLine(ctx,x1,y1,x2,y1,color,thick);
            drawLine(ctx,x2,y1,x2,y2,color,thick);
            drawLine(ctx,x2,y2,x1,y2,color,thick);
            drawLine(ctx,x1,y2,x1,y1,color,thick);
        }

        function drawLine(ctx,x1,x2,x3,x4,color,thick)//画普通的线
        {
            ctx.save();
            ctx.beginPath();
            ctx.strokeStyle=color;
            ctx.lineWidth=thick;
            ctx.moveTo(x1,x2);
            ctx.lineTo(x3,x4);
            ctx.stroke();
            ctx.restore();
        }
        function drawuLine(ctx,x1,x2,x3,x4)//画粗线
        {
            ctx.save();
            ctx.beginPath();
            ctx.strokeStyle="green";
            ctx.setLineDash([20, 5]);  // [实线长度, 间隙长度]
            ctx.lineDashOffset = -0;
            ctx.moveTo(x1,x2);
            ctx.lineTo(x3,x4);
            ctx.stroke();
            ctx.restore();
        }
        function drawpoint(ctx,x,y)
        {
            ctx.beginPath();
            ctx.strokeStyle="black";
        //  ctx.lineWidth=2;
            ctx.moveTo(x,y-1);
            ctx.lineTo(x,y+1);
            ctx.stroke();
        }

        function drawc(ctx,x,y,color,round) {//画圆点

            ctx.save();
            ctx.beginPath();
            ctx.arc(x, y, round, 0, 2* Math.PI);
            ctx.fillStyle = color;
            ctx.fill();
            ctx.restore();

        }

</script>



<script>




         function position_detect(ctx)//鼠标位置检测，看应该显示那一组数据
        {
            var index=x_transform_back(display_data_change.data1.length,mouse_x);//获得鼠标最近的数据的index
            var pos=x_transform(display_data_change.data1.length,index);

            drawLine(ctx,pos,0,pos,height,"#5cadff",2);
            detail_text(index);

            for(let key  in display_data_change){
                 //console.log(display_data[key])
                //console.log(display_data_change[key]);
                    drawc(ctx,pos,data_handel(display_data_change[key][index]),"#fff",4);
                    drawc(ctx,pos,data_handel(display_data_change[key][index]),"#2db7f5",3);
              }
        }


        function scroll_x(wheel) {



            var len=display_data_change.data1.length;


                var pos=x_transform_back(len,mouse_x);//鼠标所指的数据位置
                var cut=0;//表示缩放幅度
                if(len>10)
                {
                    cut=parseInt(len/10);
                }
                else{
                    cut=10;
                }

                    if (wheel < 0) {//向下滚动,缩小

                        console.log('向下滚动');

                        if (zoom > 0) {
                            change_left-=Math.round(cut*pos/len);
                            change_right+=Math.round(cut*(len-pos)/len);
                            zoom-=1;
                            console.log('向下滚动');
                        }
                        else if(select_range.switch)
                        {
                            if(change_left-Math.round(cut*pos/len)>0)
                            {
                                change_left-=Math.round(cut*pos/len);
                            }
                            if(change_right+Math.round(cut*(len-pos)/len)<hpv.length)
                            {
                                change_right+=Math.round(cut*(len-pos)/len);
                            }

                        }


                    } else {//向上滚动，放大


                        if (len >10 ) {
                            zoom += 1;
                            change_left+=Math.round(cut*pos/len);
                            change_right-=Math.round(cut*(len-pos)/len);
                            console.log('向上滚动');
                        }

                    }

                console.log(len);
            console.log(change_left+",,,,"+change_right);
                if(change_right>display_data.data1-1)
                    {
                        change_right=display_data.data1;
                    }
                    if(change_left<1)
                    {
                        change_left=0;
                    }

                    for(let key in display_data_change)
                    {
                        display_data_change[key]=zoom_data(display_data[key],change_left,change_right)
                    }


                    //data_time_change=zoom_data(data_time,change_left,change_right);
        }


        function scroll_y(wheel) {

            if(wheel>0)
            {
                k+=2;
            }
            else{
                k-=2;
            }
            if(k<3)
            {
                k=3;
            }
            if(k>30)
            {
                k=30;
            }

        }

        function onMouseScroll(e) {

            if (e.preventDefault) {
                    e.preventDefault();
            }
            var wheel = e.originalEvent.wheelDelta;
            if (isin == 1) {

                if(select_range.is_x)
                {
                    scroll_y(wheel);
                }
                else{
                    scroll_x(wheel);
                }
                }


        }

</script>


<script>

    function deleteCookie(cname,cvalue) {//删除cookie
    var d = new Date();
    d.setTime(d.getTime()+(10));//10毫秒后cookie过期
    var expires = "expires="+d.toGMTString();
    document.cookie = cname+"="+cvalue+"; "+"path=/;"+expires;

}//相当于注销用户

function getCookie(cname){
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for(var i=0; i<ca.length; i++) {
        var c = ca[i].trim();
        if (c.indexOf(name)==0) { return c.substring(name.length,c.length); }
    }
    return "";
}



function checkCookie1(){

    $.ajax(
                {
                    url: "/get_cookie/",
                    type: "GET",
                    data: {username:"admin1234"},

                    success: function (data) {//获取数据成功
                        console.log(data);
                        document.cookie =data;//设置cookie

                        console.log("successs");

                   },

                    error: function (data) {
                        console.log("dddddddd")
                        console.log(data)
                    }

                })

}

function checkCookie(){

    var setcok=getCookie("user_name");
    console.log(setcok);

}
function checkCookie2(){

    deleteCookie("user_name",getCookie("user_name"));
    window.location.href="/login/";
}


    var user_name=getCookie("user_name");//获取cookie中的用户名

    if(user_name=="")
    {
        alert("请登录");
        window.location.href="/login/";
    }


    document.getElementById("user").innerText="用户:"+user_name;

        var date_time_mode=new Vue({//包括绝对时间与相对时间的转换，以及历史模式与实时模式的转换
            el:'#switch_time_mode',
            data:{
                time_limit: {

                }, //日期约束
                start_time:"",
                end_time:"",
                change_mode_time:"2020-1-1 0:0:0",
                acctime_mode:0,//实时与历史
                display_time_mode:false,//显示的时间模式,false为绝对时间,
                disabled:false,//是否可以按钮

                switch1:true,//湿度开关
                switch2:true,//温度开关
                color_hpv:'#19be6b',
                color_tpv:'#ff9900',

                switch:false,
                is_x:false
            },
            methods:{
                change(status)
                {
                    console.log(status);
                },
                data_select(e)
                {
                    console.log(e);
                    this.start_time=e[0];
                    this.end_time=e[1];

                },
                close_open(status)
                {
                    if(status==false)//窗口关闭
                    {
                        if(this.start_time!=""&&this.end_time!="")
                        {

                            time_select(strto_date(this.start_time),strto_date(this.end_time));
                            //update_all_data();//更新显示的数据
                        }

                    }
                    else{
                        time_set(data_time_absolute[0],data_time_absolute[data_time_absolute.length-1]);
                        //
                    }
                    //alert("okkk")

                    console.log("sssssss"+status);
                },
                change_time_mode(status)
                {
                    //get_history();
                    this.display_time_mode=status;
                    if(status)//相对时间
                    {
                        this.disabled=true;//在相对时间模式下，不准切换历史与实时模式
                        relative_time();//时间被改了，但显示的数据还没有刷新
                        hpv_change = zoom_data(hpv,change_left,change_right);
                        tpv_change = zoom_data(tpv,change_left,change_right);
                        data_time_change=zoom_data(data_time,change_left,change_right);
                    }
                    else{
                        this.disabled=false;
                        absolute_time();
                        hpv_change = zoom_data(hpv,change_left,change_right);
                        tpv_change = zoom_data(tpv,change_left,change_right);
                        data_time_change=zoom_data(data_time,change_left,change_right);
                    }

                },
                change_mode(status)
                {
                    if(status)//历史模式
                    {

                        cancel_zoom();//取消缩放
                        get_history();//获取历史数据

                        //zoom=0;//取消缩放
                        this.acctime_mode=1;
                        //get_history();//获取历史数据
                        document.getElementById("date_picker").style.display="inline";
                    }
                    else{//实时模式
                       cancel_zoom();//取消缩放
                        this.acctime_mode=0;
                        get_status();
                        document.getElementById("date_picker").style.display="none";
                    }
                    console.log(this.acctime_mode);
                    console.log(status)
                },
                get_word0()
                {
                    alert("Sssssssssss")
                },
                hpv_switch(status)
                {
                    switch1=status;
                    console.log(status+"1111");
                },
                tpv_switch(status)
                {
                    switch2=status;
                    console.log(status+"2222");
                },
                allow_select(status){
                 this.switch=status;
                 console.log(status);

                 },
                 x_zoom(status)
                 {
                     this.is_x=status;
                     console.log(status);
                 },
                click_down() {
                    click_pos.x=mouse_x;
                    click_pos.y=mouse_y;
                    console.log("downnnnnnnnnnnn")
                    click_isdown=true;
                },
                click_up() {
                    click_isdown=false;
                    if(this.switch)
                    {
                        get_select_data(click_pos.x,mouse_x);
                    }
                }

            }

        });
     var tpv_hpv_control = date_time_mode;

     var select_range=date_time_mode;


     new Vue({
         el:'#other_function',
         data:{
             set_time:6,
             set_hpv:"15",
             set_tpv:"36",
         },
         methods:{

            get_word() {//生成word文档

                get_word0();
            },
             get_excel(){
               get_excel0();
             },
             set_submit(){
                if(this.set_time==""|| isNaN(this.set_time)){//进行数字校验，如果不是数字填出对话框进行提示
                    alert("请填写数字");
                }
                else{
                    var temp=new Object;
                    temp.TPV=this.set_tpv;
                    temp.HPV=this.set_hpv;

                    send_set(temp);
                    console.log(temp);
                }

             },

             settime_submit(){
                if(this.set_time==""|| isNaN(this.set_time)){//进行数字校验，如果不是数字填出对话框进行提示
                    alert("请填写数字");
                }
                else{

                    var temp=new Object;
                    temp.set_time=this.set_time;
                    send_set(temp);

                    console.log(temp)
                }

             },
             set_run()
             {
                 var temp=new Object;
                 temp.start_stop =0;
                 send_start_stop(temp);
                 console.log(temp);
             },
             set_stop(){
                var temp=new Object;
                 temp.start_stop =1;
                 send_start_stop(temp);
                console.log(temp)
             },
             set_jump(){
                console.log("set_jump")
             },
             set_reset(){
                console.log("set_reset")
             }
         }

     });


     function get_excel0(){
                var data=new Array();
                data.length=0;


                for(var i=0;i<hpv.length;i++)
                {
                    var temp=new Object();
                    temp.Humidity=hpv[i];
                    temp.Temperature=tpv[i];
                    temp.time=data_time[i];
                    data.push(temp);
                }

                var keys = Object.keys(data[0]);
                var firstRow = {};
                keys.forEach(function (item) {
                    firstRow[item] = item;
                });
                data.unshift(firstRow);

                var content = {};

                // 把json格式的数据转为excel的行列形式
                var sheetsData = data.map(function (item, rowIndex) {
                    return keys.map(function (key, columnIndex) {
                        return Object.assign({}, {
                            value: item[key],
                            position: (columnIndex > 25 ? getCharCol(columnIndex) : String.fromCharCode(65 + columnIndex)) + (rowIndex + 1),
                        });
                    });
                }).reduce(function (prev, next) {
                    return prev.concat(next);
                });

                sheetsData.forEach(function (item, index) {
                    content[item.position] = { v: item.value };
                });

                //设置区域,比如表格从A1到D10,SheetNames:标题，
                var coordinate = Object.keys(content);
                var workBook = {
                    SheetNames: ["helloSheet"],
                    Sheets: {
                        "helloSheet": Object.assign({}, content, { "!ref": coordinate[0] + ":" + coordinate[coordinate.length - 1] }),
                    }
                };
                //这里的数据是用来定义导出的格式类型
                var excelData = XLSX.write(workBook, { bookType: "xlsx", bookSST: false, type: "binary" });
                var blob = new Blob([string2ArrayBuffer(excelData)], { type: "" });
                saveAs(blob, new Date().Format("yyyy-MM-dd hh:mm:ss")+".xlsx" );

                 }

     function get_word0() {//生成word文档

                var start_data=strto_date(data_time_absolute[0]);

            data_time_relative[0]="0:0:0";
            for(var i=1;i<data_time_absolute.length;i++)
            {
                data_time_relative[i]=count_time(start_data,strto_date(data_time_absolute[i]));
            }//生成相对时间

            var up_image=get_image.substr(22);


                $.ajax({

                    url:"/upload_pic/",

                    type:"POST",

                    data:{
                        pic:up_image,
                        abs_time0:data_time_absolute[0],
                        abs_time1:data_time_absolute[data_time_absolute.length-1],
                        rel_time0:data_time_relative[0],
                        rel_time1:data_time_relative[data_time_relative.length-1]
                    },

                    //contentType:false,
                    //processData:false,

                    success:function(res){

                        if(res){

                            alert("上传成功！");
                        }
                        window.location.href= {{ MEDIA_URL }}+res;//下载文件
                        delete_file(res);//删除文件

                    },

                    error:function(err){

                        alert("网络连接失败,稍后重试"+err);


                    }

                })

            }


    function strto_date(da) {//字符串转date对象
        var end=new Date(Date.parse(da.replace(/-/g,"/")));
        return end;
    }


    function count_time(dateBegin,dateEnd) {//计算时间间隔

        var dateDiff = dateEnd.getTime() - dateBegin.getTime();//时间差的毫秒数
        var leave1=dateDiff%(86400000); //计算天数后剩余的毫秒数
        var hours=Math.floor(leave1/(3600000));//计算出小时数
        //计算相差分钟数
        var leave2=leave1%(3600000) ;//计算小时数后剩余的毫秒数
        var minutes=Math.floor(leave2/(60000));//计算相差分钟数
        //计算相差秒数
        var leave3=leave2%(60000); //计算分钟数后剩余的毫秒数
        var seconds=Math.round(leave3/1000);

        return hours+":"+minutes+":"+seconds;

    }




    function time_set(start,endt)//设置不可选取时间
        {
            date_time_mode.time_limit={
                disabledDate (date) {
                    var end=false;
                    if(date && date < new Date(Date.parse(start.replace(/-/g,"/")))-86400000)
                    {
                        end=true;
                    }
                    if(date && date > new Date(Date.parse(endt.replace(/-/g,"/"))))
                    {
                        end=true;
                    }
                    return end;
                }
            };
        }




        var menu = new Vue({
                el: '#navigater',
                data: {
                    theme1: 'primary'
                },
                methods:{
                    select(name)
                    {
                        if(name==3)
                        {
                            if(issuper==1)
                            {
                                window.location.href="/user_manage/";
                            }
                            else{
                                alert("你没有权限");
                            }
                        }
                        else if(name==1)
                        {
                            window.location.href="/device_manage/";
                        }
                        console.log(name);
                    },
                    cancel()
                    {
                        checkCookie2();
                    }
                }
            });






        var device_id;
        var device_name;

        device_id='{{ device_id }}'; //JSON.parse('{{ device_id }}');
        device_name='{{ device_name }}'; //JSON.parse('{{ device_name }}');
        console.log('device_id='+device_id);
        var index=0;
        var isaccept=0;
        var isin=0;
        var tpv=new Array();//新建一个温度数组
        var hpv=new Array();//新建一个湿度数组
        var data_time=new Array();//保存时间数据
/*
        var display_data=new Object;//新建一个显示数据的对象;
    display_data.data1=new Array();
    display_data.data2=new Array();
    display_data.data3=new Array();
    display_data.data4=new Array();
    */
    var display_data_str="{\"data1\":[\"0.00\",\"0.09\",\"0.09\",\"0.28\",\"0.12\",\"0.10\",\"0.36\",\"0.95\",\"0.10\",\"1.15\",\"1.59\",\"1.62\",\"1.13\",\"0.99\",\"1.67\",\"2.01\",\"0.91\",\"2.45\",\"2.29\",\"3.09\",\"1.65\",\"1.49\",\"2.66\",\"1.11\",\"2.73\",\"1.24\",\"2.13\",\"1.52\",\"2.23\",\"2.26\",\"3.72\",\"0.61\",\"0.85\",\"0.67\",\"1.56\",\"5.08\",\"1.76\",\"4.15\",\"5.17\",\"2.31\",\"6.25\",\"3.04\",\"6.63\",\"2.62\",\"2.42\",\"4.10\",\"1.28\",\"2.89\",\"2.95\",\"7.02\",\"5.37\",\"2.09\",\"7.26\",\"1.85\",\"7.23\",\"8.00\",\"5.01\",\"6.65\",\"5.80\",\"4.71\",\"0.45\",\"2.67\",\"6.93\",\"2.88\",\"7.55\",\"3.87\",\"7.67\",\"3.24\",\"0.65\",\"6.94\",\"7.14\",\"8.46\",\"7.63\",\"5.77\",\"8.50\",\"2.94\",\"1.30\",\"1.22\",\"9.31\",\"7.39\",\"8.94\",\"2.09\",\"4.20\",\"7.93\",\"3.79\",\"1.74\",\"9.52\",\"6.80\",\"6.36\",\"7.65\",\"2.15\",\"5.18\",\"5.39\",\"3.85\",\"2.57\",\"7.54\",\"3.73\",\"0.97\",\"5.85\",\"2.47\",\"2.59\",\"7.27\",\"0.26\",\"5.03\",\"5.02\",\"7.09\",\"9.19\",\"5.61\",\"5.79\",\"0.93\",\"8.95\",\"5.25\",\"3.06\",\"3.94\",\"3.17\",\"8.54\",\"3.84\",\"1.90\",\"4.24\",\"6.99\",\"1.99\",\"0.64\",\"5.23\",\"8.35\",\"6.82\",\"1.74\",\"4.37\",\"5.05\",\"6.34\",\"6.43\",\"2.20\",\"2.11\",\"0.36\",\"4.18\",\"1.06\",\"2.40\",\"3.43\",\"0.91\",\"5.67\",\"3.93\",\"4.96\",\"1.78\",\"5.79\",\"2.21\",\"4.74\",\"4.48\",\"3.58\",\"1.48\",\"3.08\",\"0.29\",\"1.88\",\"1.22\",\"0.99\",\"3.19\",\"2.07\",\"3.09\",\"0.74\",\"0.60\",\"3.60\",\"2.75\",\"2.60\",\"0.13\",\"0.13\",\"2.12\",\"2.25\",\"0.57\",\"0.73\",\"0.83\",\"1.84\",\"0.88\",\"1.47\",\"0.47\",\"0.14\",\"0.53\",\"0.07\",\"0.61\",\"0.37\",\"0.11\",\"0.23\",\"0.10\",\"-0.00\",\"-0.12\",\"-0.07\",\"-0.21\",\"-0.21\",\"-0.01\",\"-0.95\",\"-0.32\",\"-1.24\",\"-1.12\",\"-0.51\",\"-0.47\",\"-1.56\",\"-0.97\",\"-2.27\",\"-1.88\",\"-1.31\",\"-1.30\",\"-1.46\",\"-2.48\",\"-1.41\",\"-2.04\",\"-1.82\",\"-0.45\",\"-0.35\",\"-2.71\",\"-4.38\",\"-2.89\",\"-0.12\",\"-1.40\",\"-2.36\",\"-1.23\",\"-1.69\",\"-4.30\",\"-2.41\",\"-2.31\",\"-5.71\",\"-4.02\",\"-1.96\",\"-3.39\",\"-0.17\",\"-1.14\",\"-4.37\",\"-3.14\",\"-5.99\",\"-4.70\",\"-3.41\",\"-6.38\",\"-5.51\",\"-6.33\",\"-0.83\",\"-2.70\",\"-0.86\",\"-0.10\",\"-4.00\",\"-5.32\",\"-7.87\",\"-1.45\",\"-7.27\",\"-2.42\",\"-2.49\",\"-5.49\",\"-4.60\",\"-3.01\",\"-0.51\",\"-9.03\",\"-4.30\",\"-1.93\",\"-1.59\",\"-5.64\",\"-8.61\",\"-4.66\",\"-0.93\",\"-1.53\",\"-0.65\",\"-5.37\",\"-1.23\",\"-6.67\",\"-8.35\",\"-5.06\",\"-1.52\",\"-8.18\",\"-0.80\",\"-1.01\",\"-6.88\",\"-7.31\",\"-9.43\",\"-7.77\",\"-3.02\",\"-3.03\",\"-3.68\",\"-2.13\",\"-1.30\",\"-4.63\",\"-8.32\",\"-5.51\",\"-5.54\",\"-2.52\",\"-7.56\",\"-3.11\",\"-0.09\",\"-9.21\",\"-0.67\",\"-9.31\",\"-4.59\",\"-6.51\",\"-8.51\",\"-5.11\",\"-2.05\",\"-8.00\",\"-0.35\",\"-5.41\",\"-4.89\",\"-7.49\",\"-2.72\",\"-1.49\",\"-3.79\",\"-4.32\",\"-8.65\",\"-4.94\",\"-0.66\",\"-7.31\",\"-2.03\",\"-6.76\",\"-3.01\",\"-1.37\",\"-2.78\",\"-4.13\",\"-1.21\",\"-0.42\",\"-5.72\",\"-6.48\",\"-6.07\",\"-6.57\",\"-4.96\",\"-3.94\",\"-6.15\",\"-3.18\",\"-5.64\",\"-4.25\",\"-4.52\",\"-2.18\",\"-3.33\",\"-5.55\",\"-4.62\",\"-1.75\",\"-2.71\",\"-1.68\",\"-1.08\",\"-3.27\",\"-0.05\",\"-0.93\",\"-0.76\",\"-2.67\",\"-0.14\",\"-4.00\",\"-3.95\",\"-3.51\",\"-1.99\",\"-3.51\",\"-0.04\",\"-0.14\",\"-0.10\",\"-2.04\",\"-1.13\",\"-1.70\",\"-1.75\",\"-1.47\",\"-1.10\",\"-1.53\",\"-0.80\",\"-1.15\",\"-1.25\",\"-0.11\",\"-0.02\",\"-0.20\",\"-0.07\",\"-0.05\",\"-0.00\",\"-0.16\",\"0.00\",\"0.10\",\"0.01\",\"0.07\",\"0.50\",\"0.86\",\"0.46\",\"1.03\",\"1.32\",\"1.37\",\"0.72\",\"1.20\",\"1.79\",\"0.59\",\"2.12\",\"0.76\",\"1.58\",\"0.16\",\"0.00\",\"2.34\",\"2.72\",\"0.89\",\"3.20\",\"2.46\",\"3.15\",\"0.63\",\"1.76\",\"3.67\",\"3.03\",\"0.90\",\"4.38\",\"3.44\",\"3.33\",\"4.68\",\"4.80\",\"4.27\",\"2.29\",\"1.26\",\"0.66\",\"4.93\",\"2.67\",\"1.50\",\"3.70\",\"5.71\",\"1.32\",\"2.58\",\"5.72\",\"6.24\",\"6.07\",\"4.66\",\"6.97\",\"2.18\",\"0.73\",\"2.59\",\"7.93\",\"7.09\",\"2.62\",\"6.27\",\"6.05\",\"0.17\",\"3.10\",\"3.59\",\"5.59\",\"8.46\",\"0.58\",\"1.24\",\"8.96\",\"8.94\",\"1.27\",\"6.00\",\"3.91\",\"6.11\",\"2.34\",\"8.56\",\"2.68\",\"1.30\",\"5.54\",\"0.34\",\"8.02\",\"5.26\",\"0.07\",\"5.88\",\"9.16\",\"6.21\",\"5.52\",\"3.07\",\"4.52\",\"3.31\",\"3.02\",\"5.76\",\"9.53\",\"0.07\",\"6.27\",\"5.23\",\"3.32\",\"0.07\",\"7.34\",\"1.69\",\"9.61\",\"8.37\",\"8.55\",\"6.00\",\"5.40\",\"5.50\",\"1.94\",\"8.21\",\"0.99\",\"1.78\",\"2.66\",\"8.30\",\"6.97\",\"8.78\",\"6.81\",\"7.34\",\"3.80\",\"2.13\",\"4.68\",\"2.45\",\"8.09\",\"3.03\",\"3.79\",\"4.86\",\"6.59\",\"4.27\",\"2.38\",\"2.26\",\"5.41\",\"2.25\",\"5.60\",\"5.90\",\"1.16\",\"2.23\",\"3.97\",\"5.29\",\"0.69\",\"1.05\",\"4.04\",\"1.81\",\"1.59\",\"3.43\"],\"data2\":[\"0.00\",\"0.22\",\"0.23\",\"0.57\",\"0.34\",\"1.23\",\"0.69\",\"0.31\",\"0.57\",\"0.75\",\"0.34\",\"1.47\",\"1.63\",\"1.75\",\"1.84\",\"1.32\",\"1.58\",\"1.37\",\"3.10\",\"2.45\",\"4.64\",\"3.09\",\"2.88\",\"2.58\",\"1.43\",\"5.56\",\"0.10\",\"1.75\",\"2.36\",\"3.38\",\"6.88\",\"7.71\",\"5.52\",\"2.52\",\"7.14\",\"2.75\",\"0.83\",\"0.88\",\"2.14\",\"4.16\",\"7.97\",\"6.56\",\"9.09\",\"0.95\",\"8.58\",\"7.44\",\"8.22\",\"7.29\",\"3.40\",\"8.13\",\"11.11\",\"5.86\",\"9.74\",\"2.83\",\"0.99\",\"6.05\",\"11.50\",\"5.94\",\"5.11\",\"11.48\",\"6.19\",\"8.32\",\"1.94\",\"6.91\",\"3.06\",\"10.52\",\"4.24\",\"0.10\",\"0.75\",\"5.79\",\"2.19\",\"13.58\",\"3.98\",\"2.53\",\"0.64\",\"7.11\",\"6.94\",\"11.03\",\"3.02\",\"11.61\",\"7.25\",\"14.61\",\"2.68\",\"4.51\",\"14.02\",\"1.65\",\"1.75\",\"8.71\",\"3.71\",\"8.92\",\"3.01\",\"3.44\",\"12.03\",\"9.33\",\"4.79\",\"0.14\",\"1.18\",\"2.44\",\"3.31\",\"10.77\",\"3.88\",\"11.98\",\"13.44\",\"11.49\",\"11.87\",\"12.66\",\"6.58\",\"6.71\",\"1.71\",\"7.28\",\"5.07\",\"1.54\",\"6.97\",\"12.86\",\"9.33\",\"12.73\",\"10.91\",\"2.84\",\"12.69\",\"6.17\",\"11.37\",\"7.08\",\"12.52\",\"0.41\",\"4.94\",\"2.05\",\"4.98\",\"11.08\",\"3.82\",\"8.85\",\"3.93\",\"9.94\",\"0.73\",\"2.73\",\"4.35\",\"0.41\",\"0.66\",\"1.64\",\"5.11\",\"2.89\",\"2.90\",\"6.78\",\"8.40\",\"0.83\",\"4.74\",\"1.33\",\"7.20\",\"0.46\",\"2.54\",\"4.00\",\"0.48\",\"1.86\",\"0.91\",\"3.62\",\"4.34\",\"0.60\",\"2.82\",\"1.95\",\"2.66\",\"2.29\",\"2.49\",\"1.43\",\"2.77\",\"3.43\",\"1.00\",\"2.30\",\"0.95\",\"1.22\",\"0.62\",\"2.70\",\"0.83\",\"1.05\",\"1.15\",\"0.56\",\"0.20\",\"0.80\",\"0.75\",\"0.63\",\"0.19\",\"0.10\",\"-0.00\",\"-0.04\",\"-0.40\",\"-0.65\",\"-0.50\",\"-0.93\",\"-1.25\",\"-1.06\",\"-1.22\",\"-1.31\",\"-2.42\",\"-0.45\",\"-1.11\",\"-3.18\",\"-2.79\",\"-2.50\",\"-3.48\",\"-0.64\",\"-0.07\",\"-1.10\",\"-1.49\",\"-1.48\",\"-4.44\",\"-0.17\",\"-4.62\",\"-0.10\",\"-4.47\",\"-5.78\",\"-3.92\",\"-5.15\",\"-2.40\",\"-6.85\",\"-6.26\",\"-6.48\",\"-5.68\",\"-2.03\",\"-5.94\",\"-6.77\",\"-1.24\",\"-6.01\",\"-5.74\",\"-9.69\",\"-2.18\",\"-2.37\",\"-1.78\",\"-9.52\",\"-2.52\",\"-10.39\",\"-1.74\",\"-6.56\",\"-4.34\",\"-3.52\",\"-11.62\",\"-9.91\",\"-11.91\",\"-8.35\",\"-0.24\",\"-9.73\",\"-8.58\",\"-5.02\",\"-6.09\",\"-4.56\",\"-6.14\",\"-5.39\",\"-12.91\",\"-11.29\",\"-2.12\",\"-13.67\",\"-8.04\",\"-0.14\",\"-0.81\",\"-0.18\",\"-11.40\",\"-2.91\",\"-12.70\",\"-5.31\",\"-6.28\",\"-5.23\",\"-4.14\",\"-6.86\",\"-12.50\",\"-0.57\",\"-8.32\",\"-8.51\",\"-5.68\",\"-2.67\",\"-7.94\",\"-11.00\",\"-10.31\",\"-2.97\",\"-0.92\",\"-14.43\",\"-12.08\",\"-5.44\",\"-10.29\",\"-0.92\",\"-13.68\",\"-8.44\",\"-10.38\",\"-5.70\",\"-9.48\",\"-12.55\",\"-7.10\",\"-13.83\",\"-9.90\",\"-10.97\",\"-3.36\",\"-3.12\",\"-3.35\",\"-0.21\",\"-11.26\",\"-10.61\",\"-10.11\",\"-10.41\",\"-5.04\",\"-11.07\",\"-8.16\",\"-5.94\",\"-4.78\",\"-3.27\",\"-0.03\",\"-9.06\",\"-6.96\",\"-0.63\",\"-7.10\",\"-0.72\",\"-9.96\",\"-4.52\",\"-11.53\",\"-5.64\",\"-9.08\",\"-5.87\",\"-0.59\",\"-7.25\",\"-8.57\",\"-9.79\",\"-5.91\",\"-3.32\",\"-2.27\",\"-0.40\",\"-4.96\",\"-4.44\",\"-8.60\",\"-4.23\",\"-1.16\",\"-0.94\",\"-5.09\",\"-0.17\",\"-2.10\",\"-7.68\",\"-4.00\",\"-4.19\",\"-5.29\",\"-1.76\",\"-4.78\",\"-4.50\",\"-0.29\",\"-2.64\",\"-4.77\",\"-2.60\",\"-0.33\",\"-4.62\",\"-1.92\",\"-4.03\",\"-2.05\",\"-2.69\",\"-1.41\",\"-0.35\",\"-1.35\",\"-1.73\",\"-2.01\",\"-0.41\",\"-1.99\",\"-1.60\",\"-1.36\",\"-0.84\",\"-0.71\",\"-0.49\",\"-0.37\",\"-0.20\",\"0.00\",\"0.14\",\"0.13\",\"0.76\",\"0.57\",\"0.18\",\"1.49\",\"0.07\",\"0.38\",\"1.93\",\"1.13\",\"1.56\",\"3.12\",\"0.11\",\"1.91\",\"2.84\",\"0.11\",\"0.14\",\"0.25\",\"4.15\",\"0.71\",\"5.18\",\"2.31\",\"3.75\",\"0.68\",\"5.07\",\"3.52\",\"2.23\",\"1.65\",\"4.22\",\"1.04\",\"2.32\",\"2.47\",\"6.78\",\"1.02\",\"4.12\",\"6.15\",\"0.12\",\"7.35\",\"7.32\",\"8.46\",\"8.29\",\"2.82\",\"7.57\",\"4.42\",\"8.67\",\"7.62\",\"1.65\",\"5.97\",\"11.06\",\"7.05\",\"6.82\",\"8.04\",\"1.96\",\"4.15\",\"3.91\",\"0.09\",\"9.70\",\"10.39\",\"11.20\",\"4.05\",\"8.85\",\"3.94\",\"5.27\",\"7.29\",\"13.51\",\"12.64\",\"13.39\",\"7.10\",\"8.85\",\"11.35\",\"12.35\",\"7.72\",\"1.69\",\"3.31\",\"11.02\",\"2.46\",\"10.97\",\"2.85\",\"1.75\",\"5.33\",\"9.68\",\"11.38\",\"1.99\",\"8.85\",\"8.90\",\"5.66\",\"12.88\",\"0.83\",\"12.04\",\"8.64\",\"4.52\",\"1.09\",\"12.96\",\"4.35\",\"7.44\",\"2.96\",\"14.70\",\"7.09\",\"10.81\",\"2.26\",\"8.34\",\"9.40\",\"12.37\",\"1.53\",\"12.44\",\"11.50\",\"5.01\",\"1.12\",\"0.94\",\"13.18\",\"2.00\",\"6.89\",\"7.25\",\"6.34\",\"6.39\",\"5.65\",\"6.97\",\"5.54\",\"5.68\",\"8.21\",\"5.83\",\"10.14\",\"0.34\",\"12.39\",\"8.80\",\"7.17\",\"0.00\",\"2.27\",\"8.75\",\"6.09\",\"8.45\",\"0.22\",\"1.55\",\"5.14\",\"2.57\",\"3.65\",\"3.00\",\"1.58\",\"4.28\"],\"data3\":[\"0.00\",\"0.04\",\"0.57\",\"0.55\",\"0.30\",\"1.14\",\"0.85\",\"0.84\",\"2.09\",\"2.64\",\"3.37\",\"1.97\",\"1.35\",\"4.40\",\"0.25\",\"4.90\",\"1.33\",\"4.29\",\"1.68\",\"0.02\",\"2.21\",\"0.65\",\"3.65\",\"7.29\",\"3.63\",\"1.52\",\"2.76\",\"5.60\",\"5.98\",\"9.32\",\"4.43\",\"2.67\",\"7.30\",\"3.67\",\"9.35\",\"7.26\",\"4.35\",\"2.86\",\"2.70\",\"1.93\",\"9.30\",\"9.94\",\"3.14\",\"5.60\",\"1.21\",\"3.38\",\"4.40\",\"2.96\",\"14.16\",\"2.54\",\"6.74\",\"8.47\",\"5.72\",\"5.14\",\"5.14\",\"5.98\",\"13.65\",\"0.41\",\"15.12\",\"11.63\",\"7.21\",\"2.62\",\"2.35\",\"7.87\",\"4.45\",\"4.55\",\"10.98\",\"12.39\",\"13.01\",\"12.14\",\"10.84\",\"18.79\",\"15.23\",\"11.43\",\"7.59\",\"4.06\",\"6.29\",\"13.24\",\"15.20\",\"11.25\",\"19.05\",\"4.13\",\"15.48\",\"4.17\",\"4.91\",\"9.80\",\"15.33\",\"4.26\",\"18.31\",\"4.26\",\"4.66\",\"7.73\",\"11.56\",\"18.06\",\"18.26\",\"6.25\",\"14.22\",\"2.19\",\"10.97\",\"10.31\",\"8.70\",\"16.96\",\"6.59\",\"4.10\",\"0.56\",\"3.05\",\"16.12\",\"0.19\",\"15.18\",\"10.09\",\"4.54\",\"0.62\",\"17.21\",\"5.75\",\"18.20\",\"4.35\",\"12.27\",\"17.69\",\"14.61\",\"3.12\",\"4.22\",\"12.03\",\"4.41\",\"14.16\",\"8.62\",\"9.38\",\"0.32\",\"9.76\",\"11.80\",\"2.89\",\"11.70\",\"9.49\",\"10.58\",\"1.98\",\"12.83\",\"5.77\",\"8.22\",\"7.10\",\"9.16\",\"5.98\",\"11.70\",\"11.05\",\"11.85\",\"9.57\",\"0.91\",\"3.46\",\"6.37\",\"3.39\",\"6.26\",\"0.86\",\"9.83\",\"3.67\",\"0.46\",\"5.12\",\"3.79\",\"3.15\",\"2.57\",\"1.43\",\"2.81\",\"6.30\",\"1.51\",\"0.54\",\"1.89\",\"1.22\",\"3.43\",\"3.42\",\"1.94\",\"3.62\",\"3.32\",\"1.79\",\"2.72\",\"1.01\",\"2.13\",\"1.90\",\"0.09\",\"1.09\",\"0.38\",\"0.59\",\"0.06\",\"0.07\",\"-0.00\",\"-0.28\",\"-0.24\",\"-0.55\",\"-1.36\",\"-0.13\",\"-1.20\",\"-2.01\",\"-1.68\",\"-3.02\",\"-0.62\",\"-0.27\",\"-3.74\",\"-1.20\",\"-0.78\",\"-2.03\",\"-4.52\",\"-4.32\",\"-5.73\",\"-4.39\",\"-6.11\",\"-3.58\",\"-0.38\",\"-0.77\",\"-1.92\",\"-3.98\",\"-5.36\",\"-1.31\",\"-6.95\",\"-5.48\",\"-0.53\",\"-9.43\",\"-8.17\",\"-0.56\",\"-6.35\",\"-1.26\",\"-3.63\",\"-4.26\",\"-10.73\",\"-1.49\",\"-1.38\",\"-0.96\",\"-2.96\",\"-0.22\",\"-10.80\",\"-1.33\",\"-2.37\",\"-9.64\",\"-12.11\",\"-5.51\",\"-5.40\",\"-10.62\",\"-1.86\",\"-0.85\",\"-12.94\",\"-0.58\",\"-13.91\",\"-12.41\",\"-6.70\",\"-7.27\",\"-10.87\",\"-12.65\",\"-13.74\",\"-0.66\",\"-11.88\",\"-15.12\",\"-11.07\",\"-10.77\",\"-15.56\",\"-14.32\",\"-4.32\",\"-12.22\",\"-19.01\",\"-7.73\",\"-2.23\",\"-11.14\",\"-5.82\",\"-18.15\",\"-15.16\",\"-3.27\",\"-7.12\",\"-10.24\",\"-5.17\",\"-18.10\",\"-16.80\",\"-7.00\",\"-3.75\",\"-8.40\",\"-4.34\",\"-13.42\",\"-3.24\",\"-9.69\",\"-19.70\",\"-12.14\",\"-11.04\",\"-15.71\",\"-5.53\",\"-8.81\",\"-15.26\",\"-13.90\",\"-11.89\",\"-14.98\",\"-13.05\",\"-12.10\",\"-16.90\",\"-19.03\",\"-4.70\",\"-9.09\",\"-12.62\",\"-15.90\",\"-5.44\",\"-10.72\",\"-6.59\",\"-1.71\",\"-10.27\",\"-5.15\",\"-17.25\",\"-13.63\",\"-2.35\",\"-11.39\",\"-3.45\",\"-10.55\",\"-10.42\",\"-8.66\",\"-13.56\",\"-13.52\",\"-8.33\",\"-4.11\",\"-2.39\",\"-10.76\",\"-0.54\",\"-8.87\",\"-2.29\",\"-6.76\",\"-6.66\",\"-6.03\",\"-5.24\",\"-3.70\",\"-3.93\",\"-4.97\",\"-8.73\",\"-9.26\",\"-11.12\",\"-9.47\",\"-6.08\",\"-8.85\",\"-4.10\",\"-4.66\",\"-3.34\",\"-1.11\",\"-8.35\",\"-9.28\",\"-7.66\",\"-3.91\",\"-8.62\",\"-3.87\",\"-2.11\",\"-7.06\",\"-4.34\",\"-5.61\",\"-4.26\",\"-3.50\",\"-4.90\",\"-1.80\",\"-3.67\",\"-4.10\",\"-2.77\",\"-4.47\",\"-1.34\",\"-2.06\",\"-0.33\",\"-2.03\",\"-0.08\",\"-1.58\",\"-2.08\",\"-0.08\",\"-0.67\",\"-0.21\",\"-0.58\",\"-0.19\",\"0.00\",\"0.08\",\"0.50\",\"0.10\",\"0.02\",\"1.22\",\"0.52\",\"1.63\",\"1.97\",\"0.53\",\"3.22\",\"1.35\",\"1.45\",\"0.57\",\"3.99\",\"3.30\",\"3.75\",\"4.82\",\"0.86\",\"0.52\",\"0.66\",\"0.65\",\"0.35\",\"0.41\",\"2.00\",\"2.89\",\"5.63\",\"3.98\",\"2.28\",\"8.57\",\"1.15\",\"4.11\",\"6.93\",\"5.96\",\"7.42\",\"3.77\",\"5.49\",\"9.01\",\"6.34\",\"5.40\",\"0.03\",\"0.42\",\"0.12\",\"3.36\",\"4.05\",\"13.09\",\"11.95\",\"0.57\",\"9.83\",\"2.16\",\"3.49\",\"13.40\",\"11.83\",\"11.42\",\"2.34\",\"3.23\",\"11.26\",\"10.64\",\"0.32\",\"9.80\",\"13.76\",\"15.64\",\"15.14\",\"2.49\",\"14.00\",\"9.29\",\"9.72\",\"8.43\",\"4.72\",\"17.87\",\"3.31\",\"12.58\",\"1.70\",\"14.15\",\"0.33\",\"15.14\",\"19.30\",\"0.72\",\"1.48\",\"16.58\",\"7.35\",\"1.57\",\"6.33\",\"18.58\",\"8.56\",\"14.18\",\"12.77\",\"6.88\",\"15.19\",\"15.84\",\"8.97\",\"2.34\",\"18.54\",\"7.16\",\"3.13\",\"10.64\",\"1.69\",\"12.40\",\"19.69\",\"18.18\",\"2.88\",\"18.04\",\"6.49\",\"10.74\",\"5.66\",\"13.16\",\"15.63\",\"17.14\",\"7.52\",\"10.29\",\"4.52\",\"18.11\",\"12.40\",\"6.82\",\"13.81\",\"5.19\",\"4.14\",\"16.18\",\"15.15\",\"6.12\",\"6.83\",\"14.31\",\"8.39\",\"15.29\",\"6.51\",\"7.94\",\"13.10\",\"4.54\",\"12.52\",\"0.38\",\"13.09\",\"10.13\",\"4.38\",\"13.93\",\"0.52\",\"10.99\",\"13.86\",\"4.87\",\"0.13\",\"5.96\"],\"data4\":[\"0.00\",\"0.08\",\"0.34\",\"1.05\",\"1.20\",\"0.95\",\"0.98\",\"0.71\",\"2.91\",\"3.52\",\"1.96\",\"4.00\",\"3.48\",\"5.49\",\"0.76\",\"2.82\",\"6.75\",\"3.37\",\"5.45\",\"1.97\",\"2.72\",\"6.53\",\"7.66\",\"8.29\",\"1.38\",\"4.99\",\"2.65\",\"10.58\",\"11.44\",\"2.70\",\"8.35\",\"4.12\",\"10.77\",\"6.43\",\"6.59\",\"4.43\",\"10.59\",\"9.61\",\"14.17\",\"12.70\",\"12.79\",\"5.82\",\"13.82\",\"0.27\",\"10.78\",\"11.69\",\"3.72\",\"2.83\",\"1.25\",\"10.03\",\"18.43\",\"12.98\",\"3.48\",\"11.91\",\"14.16\",\"12.18\",\"20.29\",\"9.41\",\"13.12\",\"19.46\",\"20.08\",\"12.25\",\"1.14\",\"1.72\",\"16.30\",\"4.66\",\"21.69\",\"21.10\",\"7.92\",\"8.75\",\"18.17\",\"19.73\",\"10.02\",\"15.86\",\"11.17\",\"16.54\",\"22.33\",\"10.03\",\"11.35\",\"16.53\",\"7.79\",\"3.47\",\"11.54\",\"18.08\",\"2.01\",\"17.77\",\"2.26\",\"16.32\",\"0.98\",\"0.69\",\"13.24\",\"7.90\",\"1.78\",\"0.05\",\"6.50\",\"10.66\",\"9.06\",\"11.65\",\"21.19\",\"6.56\",\"9.84\",\"11.32\",\"15.67\",\"18.09\",\"11.04\",\"17.83\",\"18.85\",\"3.03\",\"8.50\",\"13.23\",\"8.82\",\"10.66\",\"11.41\",\"14.88\",\"6.40\",\"20.64\",\"6.49\",\"17.90\",\"18.10\",\"7.93\",\"4.49\",\"9.82\",\"14.26\",\"13.02\",\"16.34\",\"6.01\",\"12.78\",\"13.95\",\"0.53\",\"8.29\",\"17.98\",\"6.34\",\"13.96\",\"17.32\",\"16.31\",\"10.88\",\"8.49\",\"16.52\",\"4.67\",\"2.94\",\"4.17\",\"11.73\",\"0.38\",\"0.04\",\"10.89\",\"2.61\",\"9.70\",\"12.86\",\"0.77\",\"6.75\",\"8.04\",\"11.05\",\"1.60\",\"5.95\",\"7.52\",\"7.19\",\"1.61\",\"8.79\",\"8.80\",\"0.98\",\"5.98\",\"0.21\",\"5.72\",\"3.10\",\"2.75\",\"3.32\",\"2.22\",\"5.45\",\"3.76\",\"0.40\",\"0.92\",\"1.90\",\"1.96\",\"2.33\",\"1.37\",\"1.14\",\"0.37\",\"0.15\",\"0.29\",\"0.31\",\"-0.00\",\"-0.32\",\"-0.01\",\"-0.24\",\"-1.22\",\"-1.43\",\"-1.05\",\"-2.42\",\"-1.94\",\"-2.25\",\"-2.64\",\"-2.68\",\"-0.39\",\"-1.42\",\"-0.22\",\"-5.70\",\"-0.34\",\"-3.02\",\"-6.05\",\"-0.46\",\"-1.25\",\"-1.16\",\"-2.25\",\"-5.70\",\"-7.55\",\"-0.87\",\"-7.68\",\"-5.87\",\"-1.34\",\"-2.81\",\"-10.67\",\"-11.23\",\"-9.03\",\"-7.40\",\"-1.51\",\"-11.55\",\"-3.94\",\"-4.15\",\"-13.35\",\"-9.38\",\"-0.74\",\"-3.38\",\"-1.71\",\"-4.33\",\"-5.52\",\"-5.60\",\"-0.73\",\"-15.67\",\"-11.59\",\"-3.37\",\"-4.49\",\"-4.57\",\"-5.06\",\"-1.85\",\"-12.78\",\"-11.30\",\"-6.67\",\"-18.56\",\"-7.48\",\"-21.21\",\"-0.39\",\"-2.16\",\"-21.47\",\"-5.54\",\"-12.69\",\"-3.05\",\"-4.14\",\"-14.91\",\"-16.45\",\"-4.63\",\"-1.93\",\"-17.41\",\"-22.11\",\"-3.70\",\"-13.67\",\"-14.31\",\"-0.29\",\"-16.19\",\"-12.63\",\"-17.86\",\"-18.03\",\"-14.13\",\"-1.65\",\"-0.76\",\"-12.00\",\"-3.19\",\"-8.60\",\"-24.01\",\"-0.63\",\"-0.53\",\"-21.73\",\"-9.84\",\"-6.59\",\"-6.40\",\"-7.58\",\"-7.32\",\"-13.13\",\"-22.92\",\"-2.86\",\"-10.86\",\"-19.04\",\"-6.65\",\"-19.47\",\"-21.12\",\"-16.67\",\"-19.13\",\"-23.28\",\"-19.84\",\"-7.21\",\"-0.37\",\"-8.25\",\"-18.51\",\"-18.66\",\"-13.26\",\"-20.87\",\"-13.88\",\"-13.92\",\"-15.18\",\"-8.72\",\"-4.34\",\"-12.57\",\"-7.00\",\"-14.86\",\"-15.48\",\"-10.75\",\"-10.24\",\"-0.51\",\"-12.81\",\"-17.88\",\"-13.78\",\"-14.03\",\"-12.31\",\"-12.62\",\"-15.98\",\"-8.08\",\"-6.20\",\"-15.41\",\"-8.09\",\"-2.71\",\"-13.00\",\"-11.16\",\"-1.65\",\"-11.82\",\"-3.00\",\"-1.33\",\"-6.04\",\"-8.95\",\"-7.34\",\"-11.80\",\"-2.99\",\"-10.62\",\"-0.16\",\"-1.89\",\"-2.10\",\"-1.00\",\"-9.84\",\"-3.73\",\"-7.74\",\"-7.26\",\"-1.59\",\"-5.96\",\"-3.61\",\"-2.93\",\"-2.92\",\"-1.23\",\"-4.25\",\"-3.66\",\"-2.92\",\"-1.28\",\"-4.64\",\"-2.45\",\"-1.04\",\"-1.58\",\"-0.02\",\"-0.55\",\"-1.63\",\"-0.56\",\"-0.73\",\"-0.01\",\"-0.32\",\"0.00\",\"0.42\",\"0.52\",\"1.24\",\"0.20\",\"1.10\",\"1.16\",\"0.69\",\"3.41\",\"1.00\",\"2.71\",\"1.29\",\"1.26\",\"5.45\",\"0.27\",\"0.07\",\"1.81\",\"3.20\",\"7.32\",\"4.39\",\"1.49\",\"8.66\",\"3.95\",\"6.68\",\"1.27\",\"9.98\",\"7.68\",\"2.62\",\"3.31\",\"3.65\",\"10.36\",\"11.41\",\"4.22\",\"0.31\",\"9.81\",\"13.89\",\"5.33\",\"11.98\",\"9.79\",\"12.99\",\"10.08\",\"15.45\",\"6.23\",\"15.77\",\"8.92\",\"10.33\",\"7.79\",\"11.30\",\"8.36\",\"11.97\",\"5.56\",\"14.85\",\"0.47\",\"18.91\",\"0.85\",\"17.43\",\"0.62\",\"13.61\",\"17.39\",\"2.52\",\"15.51\",\"8.16\",\"12.17\",\"18.15\",\"10.16\",\"0.03\",\"15.81\",\"0.63\",\"15.34\",\"4.72\",\"11.74\",\"8.25\",\"12.01\",\"6.98\",\"17.98\",\"9.95\",\"10.99\",\"10.01\",\"1.65\",\"3.35\",\"21.05\",\"7.23\",\"18.42\",\"0.63\",\"13.54\",\"1.73\",\"4.17\",\"5.61\",\"15.21\",\"22.34\",\"2.73\",\"19.06\",\"8.52\",\"13.08\",\"24.22\",\"21.32\",\"0.65\",\"24.44\",\"16.06\",\"1.96\",\"0.44\",\"8.66\",\"6.21\",\"18.65\",\"19.79\",\"12.42\",\"4.92\",\"1.98\",\"21.75\",\"0.92\",\"2.69\",\"9.36\",\"19.21\",\"3.17\",\"17.32\",\"12.73\",\"9.77\",\"9.04\",\"15.31\",\"3.17\",\"3.75\",\"0.05\",\"15.45\",\"13.60\",\"19.99\",\"14.33\",\"7.78\",\"17.24\",\"12.40\",\"8.79\",\"13.20\",\"13.98\",\"18.25\",\"14.33\",\"11.37\",\"9.69\",\"3.92\",\"16.70\",\"3.92\",\"12.36\"]}"
    var display_data=JSON.parse(display_data_str);

    for(let key in display_data)
    {
        for (let i=0;i<display_data[key].length;i++)
         display_data[key][i]=Number(display_data[key][i]);

    }


    var display_data_change=new Object;//新建一个显示数据的对象;
    display_data_change.data1=new Array();
    display_data_change.data2=new Array();
    display_data_change.data3=new Array();
    display_data_change.data4=new Array();


        var tpv_change=new Array();//新建一个改变后的温度数组
        var hpv_change=new Array();//新建一个改变后的湿度数组
        var data_time_change=new Array();
        var change_left=0;
        var change_right=0;


        var data_time_relative=new Array();
        var data_time_absolute=new Array();


        var mouse_x=0;
        var mouse_y=0;
        var click_isdown=false;//鼠标是否按下
        var click_pos=new Object();
        click_pos.x=0;
        click_pos.y=0;
        var mouse_x_stop=0;
        var zoom=0;//缩放大小
        var k=10;//放大倍数
        var mod=0;//显示模式，实时与历史
        var time_mode=0;//时间显示模式，0表示绝对时间，1表示相对时间


        var c=document.getElementById("myCanvas");//获得canvas
        var get_image=c.toDataURL();
        c.width=window.screen.availWidth*0.85;

        width=c.getAttribute("width");
        height=c.getAttribute("height");


        init();

        function dataURLtoBlob(dataurl) {
            var arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1],
                bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
            while (n--) {
                u8arr[n] = bstr.charCodeAt(n);
            }
    return new Blob([u8arr], { type: mime });
}

        //excel会用到
        //字符串转字符流
        function string2ArrayBuffer(s) {
            var buf = new ArrayBuffer(s.length);
            var view = new Uint8Array(buf);
            for (var i = 0; i != s.length; ++i) view[i] = s.charCodeAt(i) & 0xFF;
            return buf;
        }
        // 将指定的自然数转换为26进制表示。映射关系：[0-25] -> [A-Z]。
        function getCharCol(n) {
            let temCol = "",
                s = "",
                m = 0
            while (n > 0) {
                m = n % 26 + 1
                s = String.fromCharCode(m + 64) + s
                n = (n - m) / 26
            }
            return s
        }



        function cancel_zoom() {//取消缩放
            zoom=0;
            data_time_change=data_time;
            hpv_change=hpv;
            tpv_change=tpv;
            change_left=0;
            change_right=hpv.length-1;

        }

        function update_all_data() {
            hpv_change = zoom_data(hpv,change_left,change_right);
            tpv_change = zoom_data(tpv,change_left,change_right);
            data_time_change=zoom_data(data_time,change_left,change_right);

        }


        function get_select_data(left,right) {
            var index_r=x_transform_back(hpv_change.length,right);
            var index_l=x_transform_back(hpv_change.length,left);
            if(index_r-index_l>9)
            {
                change_left+=index_l;
                change_right=change_left-index_l+index_r;
                console.log(change_left);
                console.log(change_right);
                hpv_change=hpv_change.slice(index_l,index_r);
                tpv_change=tpv_change.slice(index_l,index_r);
                data_time_change=data_time_change.slice(index_l,index_r);
            }
            else{
                if(date_time_mode.switch)
                {

                    alert(date_time_mode.switch+"所选区域小于十个点，请重新选择");
                }

            }



        }


        function absolute_time() {

            data_time=data_time_absolute;

        }

        function relative_time() {//获得相对时间
            var start_data=strto_date(data_time_absolute[0]);

            data_time_relative[0]="0:0:0";
            for(var i=1;i<data_time_absolute.length;i++)
            {
                data_time_relative[i]=count_time(start_data,strto_date(data_time_absolute[i]));
            }
            data_time=data_time_relative;


        }

        function time_select(start,end) {//获得通过日历选择的数据
            console.log(start);
            console.log(end);

            var start_index=0;
            var end_index=data_time_absolute.length-1;
            while(new Date(Date.parse(data_time_absolute[start_index].replace(/-/g,"/")))<start)
            {
                start_index++;
                if(start_index>data_time_absolute.length)
                {
                    break;
                }

            }
            while(new Date(Date.parse(data_time_absolute[end_index].replace(/-/g,"/")))>end)
            {
                end_index--;
                if(end_index<0)
                {
                    break;
                }

            }
            if(start_index<end_index)
            {
                data_time=data_time_absolute.slice(start_index,end_index);
                data_time_absolute=data_time_absolute.slice(start_index,end_index);
                tpv=tpv.slice(start_index,end_index);
                hpv=hpv.slice(start_index,end_index);
                console.log(data_time.length);
            }
            else{
                data_time_absolute.length=1;
                data_time.length=1;
                tpv.length=1;
                hpv.length=1;
                alert("数据不存在");
            }



        }//挑选时间

        $(document).ready(function(){
          $("#myCanvas").mouseenter(function(){
            document.getElementById("myCanvas1").style.display="inline";
            isin=1;
          });
          $("#myCanvas").mouseleave(function(){

              document.getElementById("myCanvas1").style.display="none";
            isin=0;
          });
          $('#myCanvas').on('mousewheel DOMMouseScroll', onMouseScroll);
        });

        $('#myCanvas').mousemove(function(e) {  //鼠标放在图像上时触发

             var positionX=e.pageX-$(this).offset().left; //获取当前鼠标相对img的X坐标
             var positionY=e.pageY-$(this).offset().top; //获取当前鼠标相对img的Y坐标
             mouse_x=positionX;
             mouse_y=positionY;
             isin=1;



            })


        function init() {//初始化函数
            noupdate();
            update();
            get_status();
        }
        function noupdate_y(ctx) {

            var nums=0;
            ctx.save()
            ctx.font = "bold 15px Arial";
            ctx.fillStyle="#2b85e4";
            for(i=50;i<height;i+=50)
            {
                drawLine(ctx,0,i,10,i,"#2b85e4",3);
                drawLine(ctx,0,i,width,i,"#5cadff",0.6);

                ctx.fillText(30-nums*k*2,5,i-5);
                nums++;
            }
            ctx.restore();


        }
        function get_day(data,index)//获得天
        {
            return data.slice(0,index);
        }
        function get_time(data,index) {//获得具体时间
            return data.slice(index+1,data.length);
        }
        function noupdate_x(ctx) {


             ctx.save()
            ctx.font = "bold 15px Arial";
            ctx.fillStyle="#2b85e4";

            for(var i=0;i<width;i+=150)
            {
                //alert(width);
                drawLine(ctx,i,height-10,i,height,"#2b85e4",3);
                drawLine(ctx,i,0,i,height,"#5cadff",0.6);

                data=data_time_change[parseInt(data_time_change.length*i/width)];

                if(data!=null)
                {

                    if(date_time_mode.display_time_mode)
                    {
                        ctx.fillText(data, i + 5, height-5);
                    }
                    else {

                        var index = data.indexOf(" ");
                        ctx.fillText(get_day(data, index), i + 5, height);
                        ctx.fillText(get_time(data, index), i + 5, height - 20);
                    }
                }

            }
            ctx.restore();

        }
        function noupdate() {//不需要更新的部分
            var c=document.getElementById("myCanvas");
            var ctx=c.getContext("2d");
            ctx.save();


            drawLine(ctx,0,height/2,width,height/2,"#888",2);
            drawLine(ctx,1,1,1,height,"#888",3);
            drawLine(ctx,width-75,25,width-35,25,tpv_hpv_control.color_tpv,5);
            drawLine(ctx,width-75,50,width-35,50,tpv_hpv_control.color_hpv,5);

            ctx.font = "bold 15px Arial";
            ctx.fillStyle=tpv_hpv_control.color_tpv;
            ctx.fillText("温度",width-30,30);
            ctx.fillStyle=tpv_hpv_control.color_hpv;
            ctx.fillText("湿度",width-30,55);


            noupdate_y(ctx);
            noupdate_x(ctx);

            ctx.restore();
        }
        function data_handel(dat)//数据初步处理,主要是放大作用
        {
            var da=height/2-k*dat;
            return da;
        }

        function zoom_data(data0,left,right) {

            var da=new Array();
            var k=0;
            for(var i=left;i<right;i++)
            {
                da[k]=data0[i];
                k++;
            }

            return da;

        }

        function update()//实时更新
        {

            var c = document.getElementById("myCanvas");
            var ctx = c.getContext("2d");
            get_image=c.toDataURL("image/png");
            ctx.clearRect(0, 0, width, height); //清空所有的内容

            //ctx.save();
            //ctx.fillStyle = 'rgba(10, 10, 10, 0.)';
            //ctx.fillRect(0,0,width,height);
            //ctx.restore();
            //console.log(isin);
                  //drawdata(tpv);
            noupdate();








            if(zoom==0&&!select_range.switch){
                data_time_change=data_time;
                hpv_change=hpv;
                tpv_change=tpv;

                for(let key  in display_data_change){

                    display_data_change[key]=display_data[key];
              }

                change_left=0;
                change_right=display_data.data1.length-1;
            }
            else{//会增加消耗，但实时更新
                //hpv_change = zoom_data(hpv,change_left,change_right);
                //tpv_change = zoom_data(tpv,change_left,change_right);
                //data_time_change=zoom_data(data_time,change_left,change_right);
            }



            for(let key  in display_data_change){
                 //console.log(display_data[key])
                    draw_data_all(ctx,data_off(display_data_change[key]),"#f40",1.5);
              }

             if(isin==1)
                {

                    position_detect(ctx);

                }



            if(hpv_change.length>1)
            {
                if(tpv_hpv_control.switch1)
                {
                    draw_data_all(ctx,data_off(hpv_change),tpv_hpv_control.color_hpv,1.5);
                }
                if(tpv_hpv_control.switch2)
                {
                    draw_data_all(ctx,data_off(tpv_change),tpv_hpv_control.color_tpv,1.5);
                }

                 if(isin==1)
                {

                    position_detect(ctx);
                    //drawLine(ctx,mouse_x,1,mouse_x,height,"#0f4");
                    if(tpv_hpv_control.switch1||tpv_hpv_control.switch2)
                    {
                        position_detect(ctx);
                    }

                }
            }


            if(select_range.switch)//区域选择模式
            {
                if(click_isdown)
                {
                    //ctx.rect(click_pos.x,click_pos.y,mouse_x,mouse_y);
                    //ctx.rect(20,20,150,100);
                    //ctx.stroke();
                    if(mouse_x>click_pos.x)
                    {
                        drawreact(ctx,click_pos.x,click_pos.y,mouse_x,mouse_y,"#111",2);
                        document.getElementById("accept").innerHTML="x:"+mouse_x+"\n"+"y:"+mouse_y;
                    }


                }



            }

            requestAnimationFrame(update);


        }


        Date.prototype.Format = function (fmt) { //author: meizz
            var o = {
                "M+": this.getMonth() + 1, //月份
                "d+": this.getDate(), //日
                "h+": this.getHours(), //小时
                "m+": this.getMinutes(), //分
                "s+": this.getSeconds(), //秒
                "q+": Math.floor((this.getMonth() + 3) / 3), //季度
                "S": this.getMilliseconds() //毫秒
            };
            if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
            for (var k in o)
                if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[
                    k]) : (("00" + o[k]).substr(("" + o[k]).length)));
            return fmt;
        }


    </script>




</html>
